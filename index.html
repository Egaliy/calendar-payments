<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üí∞ –ö–∞–ª–µ–Ω–¥–∞—Ä—å –ø–ª–∞—Ç–µ–∂–µ–π</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap');
    
    * {
      font-family: 'Inter', sans-serif;
    }

    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #4facfe 75%, #00f2fe 100%);
      background-size: 400% 400%;
      animation: gradientShift 15s ease infinite;
    }

    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .glass {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .glass-strong {
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(30px);
      -webkit-backdrop-filter: blur(30px);
      border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .neon-glow {
      box-shadow: 0 0 20px rgba(139, 92, 246, 0.5),
                  0 0 40px rgba(139, 92, 246, 0.3),
                  0 0 60px rgba(139, 92, 246, 0.2);
    }

    .neon-text {
      text-shadow: 0 0 10px rgba(139, 92, 246, 0.8),
                   0 0 20px rgba(139, 92, 246, 0.6),
                   0 0 30px rgba(139, 92, 246, 0.4);
    }

    input[type="range"].slider {
      -webkit-appearance: none;
      appearance: none;
      height: 8px;
      border-radius: 10px;
      outline: none;
    }

    input[type="range"].slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      cursor: pointer;
      box-shadow: 0 0 15px rgba(139, 92, 246, 0.6),
                  0 0 30px rgba(139, 92, 246, 0.4);
      transition: all 0.3s ease;
    }
    
    input[type="range"].slider::-webkit-slider-thumb:hover {
      transform: scale(1.2);
      box-shadow: 0 0 20px rgba(139, 92, 246, 0.8),
                  0 0 40px rgba(139, 92, 246, 0.6);
    }
    
    input[type="range"].slider::-moz-range-thumb {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      cursor: pointer;
      border: none;
      box-shadow: 0 0 15px rgba(139, 92, 246, 0.6),
                  0 0 30px rgba(139, 92, 246, 0.4);
      transition: all 0.3s ease;
    }
    
    input[type="range"].slider::-moz-range-thumb:hover {
      transform: scale(1.2);
      box-shadow: 0 0 20px rgba(139, 92, 246, 0.8),
                  0 0 40px rgba(139, 92, 246, 0.6);
    }

    .card-hover {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .card-hover:hover {
      transform: translateY(-4px) scale(1.02);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2),
                  0 0 30px rgba(139, 92, 246, 0.3);
    }

    .pulse-animation {
      animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    .slide-in {
      animation: slideIn 0.3s ease-out;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .bounce-in {
      animation: bounceIn 0.5s ease-out;
    }

    @keyframes bounceIn {
      0% {
        opacity: 0;
        transform: scale(0.3);
      }
      50% {
        opacity: 1;
        transform: scale(1.05);
      }
      70% {
        transform: scale(0.9);
      }
      100% {
        transform: scale(1);
      }
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useMemo, useEffect, useRef } = React;

    function startOfMonth(date) {
      return new Date(date.getFullYear(), date.getMonth(), 1);
    }

    function endOfMonth(date) {
      return new Date(date.getFullYear(), date.getMonth() + 1, 0);
    }

    function startOfYear(date) {
      return new Date(date.getFullYear(), 0, 1);
    }

    function endOfYear(date) {
      return new Date(date.getFullYear(), 11, 31);
    }

    function addMonths(date, count) {
      return new Date(date.getFullYear(), date.getMonth() + count, date.getDate());
    }

    function addWeeks(date, count) {
      const result = new Date(date);
      result.setDate(result.getDate() + count * 7);
      return result;
    }

    function addYears(date, count) {
      return new Date(date.getFullYear() + count, date.getMonth(), date.getDate());
    }

    function getDaysInMonth(date) {
      return new Date(date.getFullYear(), date.getMonth() + 1, 0).getDate();
    }

    function getFirstDayOfMonth(date) {
      const day = new Date(date.getFullYear(), date.getMonth(), 1).getDay();
      return day === 0 ? 6 : day - 1;
    }

    function isSameDay(date1, date2) {
      return date1.getFullYear() === date2.getFullYear() &&
             date1.getMonth() === date2.getMonth() &&
             date1.getDate() === date2.getDate();
    }

    function formatDateKey(date) {
      return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, "0")}-${String(date.getDate()).padStart(2, "0")}`;
    }

    function formatAmount(amount) {
      const formatted = amount.toLocaleString('ru-RU', { 
        maximumFractionDigits: 0,
        useGrouping: true
      });
      return formatted.replace(/,/g, ' ');
    }

    function SubscriptionCalendarApp() {
      const [currentMonth, setCurrentMonth] = useState(new Date());
      const [selectedDate, setSelectedDate] = useState(null);
      const [modalOpen, setModalOpen] = useState(false);
      const [payments, setPayments] = useState([]);
      const [editingPaymentId, setEditingPaymentId] = useState(null);
      const [clickedPaymentInstance, setClickedPaymentInstance] = useState(null);
      
      const [formLabel, setFormLabel] = useState("");
      const [formAmount, setFormAmount] = useState("");
      const [formFrequency, setFormFrequency] = useState("monthly");
      const [sliderValue, setSliderValue] = useState(1000);
      const sliderRef = useRef(null);

      useEffect(() => {
        const saved = localStorage.getItem('calendar-payments');
        if (saved) {
          try {
            const parsed = JSON.parse(saved);
            const paymentsWithDates = parsed.map(p => ({
              ...p,
              startDate: new Date(p.startDate),
              endDate: p.endDate ? new Date(p.endDate) : null
            }));
            setPayments(paymentsWithDates);
          } catch (e) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', e);
          }
        }
      }, []);

      useEffect(() => {
        if (payments.length > 0 || localStorage.getItem('calendar-payments')) {
          localStorage.setItem('calendar-payments', JSON.stringify(payments));
        }
      }, [payments]);

      useEffect(() => {
        if (formAmount) {
          const num = Number(formAmount.replace(/\s/g, '').replace(",", "."));
          if (!isNaN(num) && num >= 100 && num <= 100000) {
            setSliderValue(num);
          }
        }
      }, [formAmount]);

      const handleDayClick = (day) => {
        setSelectedDate(day);
        setModalOpen(true);
        setFormLabel("");
        setFormAmount("1000");
        setSliderValue(1000);
        setFormFrequency("monthly");
        setEditingPaymentId(null);
        setClickedPaymentInstance(null);
      };

      const handlePaymentClick = (e, payment) => {
        e.stopPropagation();
        const basePayment = payments.find(p => p.id === payment.baseId);
        if (basePayment) {
          const now = new Date();
          const paymentDate = new Date(payment.date);
          
          if (basePayment.frequency !== "one-time" && paymentDate > new Date(basePayment.startDate)) {
            setClickedPaymentInstance(payment);
            setEditingPaymentId(basePayment.id);
            setSelectedDate(paymentDate);
            setFormLabel(basePayment.label);
            setFormAmount(basePayment.amount.toString());
            setSliderValue(basePayment.amount);
            setFormFrequency(basePayment.frequency);
            setModalOpen(true);
          } else {
            setEditingPaymentId(basePayment.id);
            setSelectedDate(new Date(basePayment.startDate));
            setFormLabel(basePayment.label);
            setFormAmount(basePayment.amount.toString());
            setSliderValue(basePayment.amount);
            setFormFrequency(basePayment.frequency);
            setClickedPaymentInstance(null);
            setModalOpen(true);
          }
        }
      };

      const handleCloseModal = () => {
        setModalOpen(false);
        setSelectedDate(null);
        setEditingPaymentId(null);
        setClickedPaymentInstance(null);
        setFormLabel("");
        setFormAmount("1000");
        setSliderValue(1000);
        setFormFrequency("monthly");
      };

      const handleSliderChange = (e) => {
        let value = Number(e.target.value);
        let step = 100;
        if (value >= 50000) step = 10000;
        else if (value >= 10000) step = 5000;
        else if (value >= 5000) step = 1000;
        else if (value >= 1000) step = 500;
        const rounded = Math.round(value / step) * step;
        const finalValue = Math.max(100, Math.min(100000, rounded));
        setSliderValue(finalValue);
        setFormAmount(formatAmount(finalValue));
      };

      const handleAmountInputChange = (e) => {
        let value = e.target.value.replace(/\s/g, '').replace(",", ".");
        setFormAmount(value);
        const num = Number(value);
        if (!isNaN(num) && num >= 100 && num <= 100000) {
          setSliderValue(num);
        }
      };

      const handleCancelFromNow = () => {
        if (!clickedPaymentInstance) return;
        
        const basePayment = payments.find(p => p.id === editingPaymentId);
        if (basePayment) {
          const endDate = new Date(clickedPaymentInstance.date);
          endDate.setDate(endDate.getDate() - 1);
          
          setPayments((prev) => prev.map(p => 
            p.id === editingPaymentId 
              ? { ...p, endDate }
              : p
          ));
        }
        handleCloseModal();
      };

      const handleAddPayment = () => {
        if (!selectedDate) return;
        
        const parsedAmount = Number(formAmount.replace(/\s/g, '').replace(",", "."));
        if (isNaN(parsedAmount) || parsedAmount <= 0 || parsedAmount > 100000) {
          alert("–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É (–æ—Ç 100 –¥–æ 100 000 ‚ÇΩ)");
          return;
        }

        if (editingPaymentId && !clickedPaymentInstance) {
          setPayments((prev) => prev.map(p => 
            p.id === editingPaymentId 
              ? {
                  ...p,
                  label: formLabel.trim() || "–ü–ª–∞—Ç—ë–∂",
                  amount: parsedAmount,
                  startDate: new Date(selectedDate),
                  frequency: formFrequency,
                  endDate: null
                }
              : p
          ));
        } else {
          const newPayment = {
            id: `${Date.now()}-${Math.random().toString(16).slice(2)}`,
            label: formLabel.trim() || "–ü–ª–∞—Ç—ë–∂",
            amount: parsedAmount,
            startDate: new Date(selectedDate),
            frequency: formFrequency,
            endDate: null
          };
          setPayments((prev) => [...prev, newPayment]);
        }
        
        handleCloseModal();
      };

      const handleKeyPress = (e) => {
        if (e.key === 'Enter') {
          handleAddPayment();
        }
      };

      const handleRemovePayment = (id) => {
        setPayments((prev) => prev.filter((p) => p.id !== id));
      };

      const fileInputRef = useRef(null);

      const handleExport = () => {
        const dataStr = JSON.stringify(payments, null, 2);
        const dataBlob = new Blob([dataStr], { type: 'application/json' });
        const url = URL.createObjectURL(dataBlob);
        const link = document.createElement('a');
        link.href = url;
        link.download = `calendar-payments-${new Date().toISOString().split('T')[0]}.json`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
      };

      const handleImport = (e) => {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = (event) => {
          try {
            const imported = JSON.parse(event.target.result);
            if (Array.isArray(imported)) {
              const paymentsWithDates = imported.map(p => ({
                ...p,
                startDate: new Date(p.startDate),
                endDate: p.endDate ? new Date(p.endDate) : null
              }));
              setPayments(paymentsWithDates);
              alert(`–£—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ ${paymentsWithDates.length} –ø–ª–∞—Ç–µ–∂–µ–π`);
            } else {
              alert('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞');
            }
          } catch (error) {
            alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–∞: ' + error.message);
          }
        };
        reader.readAsText(file);
        e.target.value = '';
      };

      const { upcomingPayments, displayedMonthTotal, displayedYearTotal } = useMemo(() => {
        const displayedMonthStart = startOfMonth(currentMonth);
        const displayedMonthEnd = endOfMonth(currentMonth);
        const displayedYearStart = startOfYear(currentMonth);
        const displayedYearEnd = endOfYear(currentMonth);
        const horizonEnd = addYears(new Date(), 2);

        const upcomingPayments = [];
        let displayedMonthTotal = 0;
        let displayedYearTotal = 0;

        const seenDates = new Set();

        payments.forEach((p) => {
          const amount = Number(p.amount);
          if (!amount || amount <= 0) return;

          const start = new Date(p.startDate);
          if (isNaN(start.getTime())) return;

          const end = p.endDate ? new Date(p.endDate) : null;

          let d = new Date(start);
          let iteration = 0;
          const maxIterations = 1000;

          while (d <= horizonEnd && iteration < maxIterations) {
            iteration++;

            if (end && d > end) break;

            const dateKey = formatDateKey(d);
            const paymentKey = `${p.id}-${dateKey}`;
            if (seenDates.has(paymentKey)) {
              if (p.frequency === "yearly") {
                d = addYears(d, 1);
              } else if (p.frequency === "monthly") {
                const originalDayOfMonth = start.getDate();
                let nextDate = addMonths(d, 1);
                const daysInNextMonth = getDaysInMonth(nextDate);
                const targetDay = Math.min(originalDayOfMonth, daysInNextMonth);
                d = new Date(nextDate.getFullYear(), nextDate.getMonth(), targetDay);
              } else if (p.frequency === "weekly") {
                d = addWeeks(d, 1);
              } else {
                break;
              }
              continue;
            }
            seenDates.add(paymentKey);

            upcomingPayments.push({
              id: paymentKey,
              baseId: p.id,
              label: p.label,
              amount,
              date: new Date(d),
              frequency: p.frequency,
            });

            if (d >= displayedMonthStart && d <= displayedMonthEnd) {
              displayedMonthTotal += amount;
            }
            if (d >= displayedYearStart && d <= displayedYearEnd) {
              displayedYearTotal += amount;
            }

            if (p.frequency === "one-time") {
              break;
            } else if (p.frequency === "yearly") {
              d = addYears(d, 1);
            } else if (p.frequency === "monthly") {
              const originalDayOfMonth = start.getDate();
              let nextDate = addMonths(d, 1);
              const daysInNextMonth = getDaysInMonth(nextDate);
              const targetDay = Math.min(originalDayOfMonth, daysInNextMonth);
              d = new Date(nextDate.getFullYear(), nextDate.getMonth(), targetDay);
            } else if (p.frequency === "weekly") {
              d = addWeeks(d, 1);
            }
          }
        });

        upcomingPayments.sort((a, b) => a.date - b.date);

        return { upcomingPayments, displayedMonthTotal, displayedYearTotal };
      }, [payments, currentMonth]);

      const paymentsByDate = useMemo(() => {
        const map = {};
        upcomingPayments.forEach((p) => {
          const key = formatDateKey(p.date);
          if (!map[key]) {
            map[key] = [];
          }
          map[key].push(p);
        });
        return map;
      }, [upcomingPayments]);

      const calendarDays = useMemo(() => {
        const days = [];
        const daysInMonth = getDaysInMonth(currentMonth);
        const firstDay = getFirstDayOfMonth(currentMonth);
        
        const prevMonth = addMonths(currentMonth, -1);
        const daysInPrevMonth = getDaysInMonth(prevMonth);
        for (let i = firstDay - 1; i >= 0; i--) {
          const date = new Date(prevMonth.getFullYear(), prevMonth.getMonth(), daysInPrevMonth - i);
          days.push({ date, isCurrentMonth: false });
        }
        
        for (let i = 1; i <= daysInMonth; i++) {
          const date = new Date(currentMonth.getFullYear(), currentMonth.getMonth(), i);
          days.push({ date, isCurrentMonth: true });
        }
        
        const totalCells = days.length;
        const remainingCells = 42 - totalCells;
        const nextMonth = addMonths(currentMonth, 1);
        for (let i = 1; i <= remainingCells; i++) {
          const date = new Date(nextMonth.getFullYear(), nextMonth.getMonth(), i);
          days.push({ date, isCurrentMonth: false });
        }
        
        return days;
      }, [currentMonth]);

      const monthNames = [
        "–Ø–Ω–≤–∞—Ä—å", "–§–µ–≤—Ä–∞–ª—å", "–ú–∞—Ä—Ç", "–ê–ø—Ä–µ–ª—å", "–ú–∞–π", "–ò—é–Ω—å",
        "–ò—é–ª—å", "–ê–≤–≥—É—Å—Ç", "–°–µ–Ω—Ç—è–±—Ä—å", "–û–∫—Ç—è–±—Ä—å", "–ù–æ—è–±—Ä—å", "–î–µ–∫–∞–±—Ä—å"
      ];

      const weekDays = ["–ü–Ω", "–í—Ç", "–°—Ä", "–ß—Ç", "–ü—Ç", "–°–±", "–í—Å"];

      const frequencies = [
        { value: "one-time", label: "–†–∞–∑–æ–≤—ã–π", icon: "‚ö°", color: "from-yellow-400 to-orange-500" },
        { value: "weekly", label: "–ù–µ–¥–µ–ª—è", icon: "üîÑ", color: "from-pink-400 to-rose-500" },
        { value: "monthly", label: "–ú–µ—Å—è—Ü", icon: "üìÖ", color: "from-purple-400 to-indigo-500" },
        { value: "yearly", label: "–ì–æ–¥", icon: "üåü", color: "from-cyan-400 to-blue-500" }
      ];

      const handlePrevMonth = () => {
        setCurrentMonth(addMonths(currentMonth, -1));
      };

      const handleNextMonth = () => {
        setCurrentMonth(addMonths(currentMonth, 1));
      };

      const handleToday = () => {
        setCurrentMonth(new Date());
      };

      return (
        <div className="min-h-screen relative overflow-hidden">
          {/* –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ–Ω */}
          <div className="fixed inset-0 -z-10">
            <div className="absolute top-0 left-0 w-96 h-96 bg-purple-500 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-pulse"></div>
            <div className="absolute top-0 right-0 w-96 h-96 bg-pink-500 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-pulse" style={{ animationDelay: '2s' }}></div>
            <div className="absolute bottom-0 left-1/2 w-96 h-96 bg-cyan-500 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-pulse" style={{ animationDelay: '4s' }}></div>
          </div>

          {/* –ö–Ω–æ–ø–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞/–∏–º–ø–æ—Ä—Ç–∞ */}
          <div className="fixed bottom-6 right-6 z-40 flex gap-3">
            <input
              type="file"
              accept=".json"
              ref={fileInputRef}
              onChange={handleImport}
              className="hidden"
            />
            <button
              onClick={handleExport}
              className="w-12 h-12 rounded-full glass-strong flex items-center justify-center text-white hover:scale-110 transition-all duration-300 shadow-lg hover:shadow-xl neon-glow"
              title="–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö"
            >
              <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
              </svg>
            </button>
            <button
              onClick={() => fileInputRef.current?.click()}
              className="w-12 h-12 rounded-full glass-strong flex items-center justify-center text-white hover:scale-110 transition-all duration-300 shadow-lg hover:shadow-xl neon-glow"
              title="–ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö"
            >
              <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
              </svg>
            </button>
          </div>

          {/* –®–∞–ø–∫–∞ */}
          <div className="relative z-10 pt-8 pb-6">
            <div className="max-w-7xl mx-auto px-4">
              <h1 className="text-5xl font-black text-white mb-2 neon-text slide-in">
                üí∞ –ö–∞–ª–µ–Ω–¥–∞—Ä—å –ø–ª–∞—Ç–µ–∂–µ–π
              </h1>
              <p className="text-white/80 text-lg mb-6">–£–ø—Ä–∞–≤–ª—è–π —Ñ–∏–Ω–∞–Ω—Å–∞–º–∏ –∫–∞–∫ –ø—Ä–æ</p>
              
              <div className="flex flex-wrap gap-4 mb-6">
                <div className="glass-strong rounded-2xl px-6 py-4 card-hover min-w-[200px]">
                  <div className="text-white/70 text-sm mb-2 font-medium">
                    {monthNames[currentMonth.getMonth()]} {currentMonth.getFullYear()}
                  </div>
                  <div className="text-3xl font-bold text-white">
                    {formatAmount(displayedMonthTotal)} ‚ÇΩ
                  </div>
                </div>
                <div className="glass-strong rounded-2xl px-6 py-4 card-hover min-w-[200px]">
                  <div className="text-white/70 text-sm mb-2 font-medium">
                    –í–µ—Å—å {currentMonth.getFullYear()} –≥–æ–¥
                  </div>
                  <div className="text-3xl font-bold text-white">
                    {formatAmount(displayedYearTotal)} ‚ÇΩ
                  </div>
                </div>
              </div>
            </div>
          </div>

          {/* –ö–∞–ª–µ–Ω–¥–∞—Ä—å */}
          <div className="max-w-7xl mx-auto px-4 pb-8 relative z-10">
            <div className="glass-strong rounded-3xl shadow-2xl overflow-hidden slide-in">
              {/* –ù–∞–≤–∏–≥–∞—Ü–∏—è */}
              <div className="flex items-center justify-between px-6 py-5 border-b border-white/20">
                <div className="flex items-center gap-4">
                  <button
                    onClick={handlePrevMonth}
                    className="w-10 h-10 rounded-full glass flex items-center justify-center text-white hover:scale-110 transition-all duration-300 hover:neon-glow"
                  >
                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
                    </svg>
                  </button>
                  <h2 className="text-2xl font-bold text-white">
                    {monthNames[currentMonth.getMonth()]} {currentMonth.getFullYear()}
                  </h2>
                  <button
                    onClick={handleNextMonth}
                    className="w-10 h-10 rounded-full glass flex items-center justify-center text-white hover:scale-110 transition-all duration-300 hover:neon-glow"
                  >
                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
                    </svg>
                  </button>
                </div>
                <button
                  onClick={handleToday}
                  className="px-5 py-2 rounded-xl glass text-white font-semibold hover:scale-105 transition-all duration-300 hover:neon-glow"
                >
                  –°–µ–≥–æ–¥–Ω—è
                </button>
              </div>

              {/* –°–µ—Ç–∫–∞ –∫–∞–ª–µ–Ω–¥–∞—Ä—è */}
              <div className="p-6">
                <div className="grid grid-cols-7 gap-2 mb-3">
                  {weekDays.map((day) => (
                    <div key={day} className="text-center text-sm font-bold text-white/80 py-2">
                      {day}
                    </div>
                  ))}
                </div>

                <div className="grid grid-cols-7 gap-2">
                  {calendarDays.map((day, index) => {
                    const dayKey = formatDateKey(day.date);
                    const dayPayments = paymentsByDate[dayKey] || [];
                    const isToday = isSameDay(day.date, new Date());
                    const totalForDay = dayPayments.reduce((sum, p) => sum + p.amount, 0);

                    return (
                      <div
                        key={index}
                        onClick={() => handleDayClick(day.date)}
                        className={`
                          min-h-[100px] p-2 rounded-xl cursor-pointer card-hover
                          transition-all duration-300
                          ${day.isCurrentMonth 
                            ? 'glass hover:glass-strong' 
                            : 'glass opacity-40 hover:opacity-60'
                          }
                          ${isToday 
                            ? 'ring-2 ring-white/50 neon-glow scale-105' 
                            : ''
                          }
                        `}
                      >
                        <div className={`
                          text-sm font-bold mb-1
                          ${isToday 
                            ? 'text-white text-lg' 
                            : day.isCurrentMonth 
                              ? 'text-white' 
                              : 'text-white/50'
                          }
                        `}>
                          {day.date.getDate()}
                        </div>
                        {dayPayments.length > 0 && (
                          <div className="space-y-1">
                            {dayPayments.slice(0, 2).map((p) => (
                              <div
                                key={p.id}
                                onClick={(e) => handlePaymentClick(e, p)}
                                className="text-xs px-2 py-1 bg-gradient-to-r from-purple-500/30 to-pink-500/30 text-white rounded-lg truncate cursor-pointer hover:from-purple-500/50 hover:to-pink-500/50 transition-all backdrop-blur-sm border border-white/20"
                                title={`${p.label} - ${formatAmount(p.amount)} ‚ÇΩ`}
                              >
                                {p.label}
                              </div>
                            ))}
                            {dayPayments.length > 2 && (
                              <div className="text-xs text-white/60 font-semibold">
                                +{dayPayments.length - 2}
                              </div>
                            )}
                            {totalForDay > 0 && (
                              <div className="text-xs font-bold text-white mt-1">
                                {formatAmount(totalForDay)} ‚ÇΩ
                              </div>
                            )}
                          </div>
                        )}
                      </div>
                    );
                  })}
                </div>
              </div>
            </div>
          </div>

          {/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */}
          {modalOpen && (
            <div className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-fadeIn">
              <div className="glass-strong rounded-3xl shadow-2xl max-w-md w-full p-8 bounce-in">
                <div className="flex items-center justify-between mb-6">
                  <h3 className="text-2xl font-black text-white">
                    {editingPaymentId ? '‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å' : '‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–ª–∞—Ç—ë–∂'}
                  </h3>
                  <button
                    onClick={handleCloseModal}
                    className="w-10 h-10 rounded-full glass flex items-center justify-center text-white hover:scale-110 transition-all hover:bg-red-500/30"
                  >
                    <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                    </svg>
                  </button>
                </div>

                <div className="mb-6">
                  <div className="text-sm text-white/70 font-medium">
                    üìÖ {selectedDate?.toLocaleDateString('ru-RU', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}
                  </div>
                </div>

                {clickedPaymentInstance && (
                  <div className="mb-6 p-4 glass rounded-xl border border-yellow-400/30">
                    <p className="text-sm text-yellow-200 mb-3 font-medium">
                      ‚ö†Ô∏è –≠—Ç–æ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–π—Å—è –ø–ª–∞—Ç—ë–∂. –ú–æ–∂–µ—à—å –æ—Ç–º–µ–Ω–∏—Ç—å —Å —ç—Ç–æ–≥–æ –º–æ–º–µ–Ω—Ç–∞.
                    </p>
                    <button
                      onClick={handleCancelFromNow}
                      className="text-sm text-yellow-300 hover:text-yellow-100 font-bold underline"
                    >
                      –û—Ç–º–µ–Ω–∏—Ç—å —Å —ç—Ç–æ–≥–æ –º–æ–º–µ–Ω—Ç–∞
                    </button>
                  </div>
                )}

                <div className="space-y-5">
                  <div>
                    <label className="block text-sm font-bold text-white mb-2">
                      –ù–∞–∑–≤–∞–Ω–∏–µ
                    </label>
                    <input
                      type="text"
                      className="w-full rounded-xl glass border border-white/20 px-4 py-3 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-purple-400 focus:border-transparent transition-all"
                      placeholder="Spotify, –∞—Ä–µ–Ω–¥–∞, –¥–æ–º–µ–Ω‚Ä¶"
                      value={formLabel}
                      onChange={(e) => setFormLabel(e.target.value)}
                      onKeyPress={handleKeyPress}
                      autoFocus
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-bold text-white mb-3">
                      üíµ –°—É–º–º–∞: <span className="text-purple-300">{formatAmount(sliderValue)} ‚ÇΩ</span>
                    </label>
                    <div className="space-y-4">
                      <input
                        type="range"
                        min="100"
                        max="100000"
                        step="100"
                        value={sliderValue}
                        onChange={handleSliderChange}
                        className="w-full slider"
                        ref={sliderRef}
                        style={{
                          background: `linear-gradient(to right, rgba(139, 92, 246, 0.8) 0%, rgba(139, 92, 246, 0.8) ${(sliderValue - 100) / (100000 - 100) * 100}%, rgba(255, 255, 255, 0.2) ${(sliderValue - 100) / (100000 - 100) * 100}%, rgba(255, 255, 255, 0.2) 100%)`
                        }}
                      />
                      <input
                        type="text"
                        inputMode="decimal"
                        className="w-full rounded-xl glass border border-white/20 px-4 py-3 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-purple-400 focus:border-transparent transition-all"
                        placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É"
                        value={formAmount}
                        onChange={handleAmountInputChange}
                        onKeyPress={handleKeyPress}
                      />
                    </div>
                  </div>

                  <div>
                    <label className="block text-sm font-bold text-white mb-3">
                      –ü–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å
                    </label>
                    <div className="grid grid-cols-2 gap-3">
                      {frequencies.map((freq) => {
                        const isActive = formFrequency === freq.value;
                        return (
                          <button
                            key={freq.value}
                            onClick={() => setFormFrequency(freq.value)}
                            className={`
                              flex flex-col items-center justify-center gap-2 px-4 py-4 rounded-xl font-bold text-sm
                              transition-all duration-300
                              ${isActive 
                                ? `glass-strong bg-gradient-to-br ${freq.color} text-white scale-105 neon-glow shadow-xl` 
                                : 'glass text-white/70 hover:text-white hover:scale-105'
                              }
                            `}
                          >
                            <span className="text-2xl">{freq.icon}</span>
                            <span>{freq.label}</span>
                          </button>
                        );
                      })}
                    </div>
                  </div>

                  <div className="flex gap-3 pt-2">
                    {editingPaymentId && !clickedPaymentInstance && (
                      <button
                        onClick={() => {
                          handleRemovePayment(editingPaymentId);
                          handleCloseModal();
                        }}
                        className="px-5 py-3 rounded-xl bg-gradient-to-r from-red-500 to-pink-600 text-white font-bold hover:scale-105 transition-all shadow-lg hover:shadow-xl"
                      >
                        –£–¥–∞–ª–∏—Ç—å
                      </button>
                    )}
                    <button
                      onClick={handleCloseModal}
                      className="flex-1 px-5 py-3 rounded-xl glass text-white font-bold hover:scale-105 transition-all"
                    >
                      –û—Ç–º–µ–Ω–∞
                    </button>
                    <button
                      onClick={handleAddPayment}
                      className="flex-1 px-5 py-3 rounded-xl bg-gradient-to-r from-purple-500 to-pink-500 text-white font-bold hover:scale-105 transition-all shadow-lg hover:shadow-xl neon-glow"
                    >
                      {editingPaymentId ? 'üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å' : '‚ú® –î–æ–±–∞–≤–∏—Ç—å'}
                    </button>
                  </div>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<SubscriptionCalendarApp />);
  </script>
</body>
</html>
